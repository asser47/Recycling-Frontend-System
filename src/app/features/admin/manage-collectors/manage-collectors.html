<div class="card p-4 shadow-sm collectors-card">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="fw-bold">Collectors</h4>

    <input
      class="form-control search-input"
      placeholder="Search by name or email"
      [(ngModel)]="search"
      (input)="filter()"
    />
  </div>

  @if(loading) {
    <p class="text-center">Loading...</p>
  }

  @else {
    <table class="table table-bordered table-hover text-center align-middle">
      <thead class="table-light">
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th width="200">Actions</th>
        </tr>
      </thead>

      <tbody>
        @for(c of filtered; track c.id) {
          <tr>
            <td>{{ c.fullName }}</td>
            <td>{{ c.email }}</td>
            <td>{{ c.phoneNumber }}</td>
            <td>
              <button
                class="btn btn-sm btn-primary me-2"
                (click)="openOrdersModal(c)">
                Orders
              </button>

              <button
                class="btn btn-sm btn-danger"
                (click)="delete(c.id!)">
                Remove
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>

    @if(filtered.length === 0) {
      <p class="text-center text-muted">No collectors found</p>
    }
  }
</div>

<!-- ================= ORDERS MODAL ================= -->
<div class="modal fade show modal-custom"
     *ngIf="ordersModalOpen"
     [style.display]="'block'">

  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">
          Orders - {{ selectedCollector?.fullName }}
        </h5>
        <button class="btn-close" (click)="closeOrdersModal()"></button>
      </div>

      <div class="modal-body">

        @if(loadingOrders) {
          <p class="text-center">Loading orders...</p>
        }

        @else {
          <table class="table table-bordered text-center">
            <thead class="table-light">
              <tr>
                <th>#</th>
                <th>Status</th>
                <th>Date</th>
              </tr>
            </thead>

            <tbody>
              @for(o of collectorOrders; track o.id) {
                <tr>
                  <td>{{ o.id }}</td>
                  <td>
                    <span class="badge bg-info">
                      {{ o.status }}
                    </span>
                  </td>
                  <td>{{ o.orderDate | date:'short' }}</td>
                </tr>
              }

              @if(collectorOrders.length === 0) {
                <tr>
                  <td colspan="3" class="text-muted">
                    No orders found
                  </td>
                </tr>
              }
            </tbody>
          </table>
        }

      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeOrdersModal()">Close</button>
      </div>

    </div>
  </div>
</div>

<div class="modal-backdrop fade show" *ngIf="ordersModalOpen"></div>
