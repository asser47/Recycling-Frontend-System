<div class="page-header">
  <div>
    <h1 class="page-title">Collectors</h1>
    <p class="page-sub">Manage platform collectors</p>
  </div>

  <div class="search-box">
    <input
      type="text"
      placeholder="ðŸ” Search by name or email"
      [(ngModel)]="search"
      (input)="filter()"
    />
  </div>
</div>

<div class="table-card">
  @if(loading) {
    <p class="text-center">Loading...</p>
  }

  @else {
    <table>
      <thead>
        <tr>
          <th>Collector</th>
          <th>Email</th>
          <th>Phone</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        @for(c of filtered; track c.id) {
          <tr>
            <td class="collector-cell">
              <div class="avatar">{{ c.fullName[0] }}</div>
              <span>{{ c.fullName }}</span>
            </td>
            <td>{{ c.email }}</td>
            <td>{{ c.phoneNumber }}</td>
            <td class="actions-cell">
              <button class="btn-view" (click)="openOrdersModal(c)">
                Orders
              </button>
              <button class="btn-remove" (click)="delete(c.id!)">
                Remove
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>

    @if(filtered.length === 0) {
      <p class="text-center text-muted">No collectors found</p>
    }
  }
</div>

<!-- ================= ORDERS MODAL ================= -->
@if (ordersModalOpen) {
<div class="details-modal">
  <div class="details-content modal-lg">

    <div class="modal-header">
      <h3>Orders - {{ selectedCollector?.fullName }}</h3>
      <button class="close-x" (click)="closeOrdersModal()">âœ•</button>
    </div>

    @if(loadingOrders) {
      <p class="text-center">Loading orders...</p>
    }

    @else {
      <table class="orders-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Status</th>
            <th>Date</th>
          </tr>
        </thead>

        <tbody>
          @for(o of collectorOrders; track o.id) {
            <tr>
              <td>{{ o.id }}</td>
              <td>
                <span class="badge {{ o.status.toLowerCase() }}">
                  {{ o.status }}
                </span>
              </td>
              <td>{{ o.orderDate | date:'short' }}</td>
            </tr>
          }

          @if(collectorOrders.length === 0) {
            <tr>
              <td colspan="3" class="text-muted">
                No orders found
              </td>
            </tr>
          }
        </tbody>
      </table>
    }

  </div>
</div>
}
