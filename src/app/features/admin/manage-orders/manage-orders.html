<h1 class="page-title">Orders Management</h1>
<p class="page-sub">View orders, users, collectors and status updates.</p>

<!-- FILTERS -->
<div class="section-card filter-section">
  <h3>Filter Orders</h3>

<div class="form-row">
  <label for="statusFilterSelect" class="visually-hidden">Order Status Filter</label>
  <select id="statusFilterSelect" [(ngModel)]="statusFilter" (change)="filter()" aria-label="Order Status Filter">
    <option value="">Filter by Status</option>
    <option>Pending</option>
    <option>Accepted</option>
    <option>Completed</option>
    <option>Cancelled</option>
  </select>

  <input type="text" placeholder="Search by User Name" [(ngModel)]="userFilter" (input)="filter()">
  <input type="text" placeholder="Search by Collector Name" [(ngModel)]="collectorFilter" (input)="filter()">
  <input type="text" placeholder="Search by Factory Name" [(ngModel)]="factoryFilter" (input)="filter()">

  <button class="btn-clear" (click)="clearFilters()">Clear</button>
</div>

</div>

<!-- ORDERS TABLE -->
<div class="section-card">
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Date</th>
        <th>Status</th>
        <th>User</th>
        <th>Collector</th>
        <th>Factory</th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      @for (o of orders; track o.id) {
        <tr>
          <td>{{ o.id }}</td>
          <td>{{ o.orderDate | date }}</td>
          <td><span class="badge {{ o.status.toLowerCase() }}">{{ o.status }}</span></td>
          <td>{{ o.userName }}</td>
          <td>{{ o.collectorName }}</td>
          <td>{{ o.factoryName }}</td>
          <td><button class="btn-view" (click)="showDetails(o.id!)">View</button></td>
        </tr>
      }
    </tbody>
  </table>
</div>

<!-- DETAILS MODAL -->
@if (selectedOrder) {
<div class="details-modal">
  <div class="details-content">
    <h3>Order Details</h3>

    <p><b>ID:</b> {{ selectedOrder.id }}</p>
    <p><b>Status:</b> {{ selectedOrder.status }}</p>
    <p><b>User:</b> {{ selectedOrder.userName }}</p>
    <p><b>Collector:</b> {{ selectedOrder.collectorName }}</p>
    <p><b>Factory:</b> {{ selectedOrder.factoryName }}</p>

    @if (isAdmin()) {
      <h4>Change Status</h4>
      <div class="btn-group">
        <button (click)="updateStatus('Accepted')">Accept</button>
        <button (click)="updateStatus('Completed')">Complete</button>
        <button (click)="updateStatus('Cancelled')">Cancel</button>
      </div>
    }

    <button class="btn-close" (click)="closeDetails()">Close</button>
  </div>
</div>
}
