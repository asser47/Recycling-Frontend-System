
  <div class="min-h-screen py-8 px-6 lg:px-8">
  <div class="max-w-7xl mx-auto space-y-8">

    <!-- Top Row: Header + Points + Cart -->
    <div class="top-row">
      <!-- Header Section -->
      <div class="header-section">
        <h1 class="page-title">ğŸ {{ t('rewards') || 'Rewards Store' }}</h1>
        <p class="page-subtitle">{{ t('redeemDescription') || 'Redeem your points for amazing rewards' }}</p>
      </div>

      <!-- Points Card -->
      <div class="stats-section">
        <app-citizen-stats-cards [stats]="stats()"></app-citizen-stats-cards>
      </div>

      <!-- Cart Card -->
      <div class="cart-card" (click)="openCart()">
        <div class="cart-icon">ğŸ›’</div>
        <div class="cart-info">
          <p class="cart-label">My Cart</p>
          <h2 class="cart-count">{{ cartItemCount() }} item{{ cartItemCount() !== 1 ? 's' : '' }}</h2>
          <p class="cart-total">{{ cartTotal() }} points</p>
        </div>
        @if (cartItemCount() > 0) {
          <div class="cart-badge">{{ cartItemCount() }}</div>
        }
      </div>
    </div>

    <!-- Search Bar -->
    <div class="search-section">
      <div class="search-bar">
        <input
          class="search-input"
          placeholder="ğŸ” Search rewards..."
          [(ngModel)]="searchTerm"
          (keyup.enter)="search()">
        <button class="search-btn" (click)="search()">Search</button>
        <button class="reset-btn" (click)="resetSearch()">Reset</button>
      </div>
    </div>

  <!-- Toast Notification -->
  @if (showToast) {
    <div class="toast-notification" [class.success]="toastType === 'success'" [class.error]="toastType === 'error'">
      <div class="toast-icon">
        @if (toastType === 'success') {
          <span>âœ…</span>
        } @else {
          <span>âŒ</span>
        }
      </div>
      <div class="toast-content">
        <p class="toast-title">{{ toastType === 'success' ? 'Success' : 'Error' }}</p>
        <p class="toast-message">{{ toastMessage }}</p>
      </div>
      <button class="toast-close" (click)="closeToast()">Ã—</button>
    </div>
  }

  @if (isLoading) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p class="loading-text">Loading rewards...</p>
    </div>
  }

  @if (!isLoading && rewards.length === 0) {
    <div class="empty-container">
      <div class="empty-icon">ğŸ</div>
      <h2 class="empty-title">No Rewards Found</h2>
      <p class="empty-subtitle">
        @if (searchTerm) {
          No rewards match your search. Try different keywords or reset the search.
        } @else {
          Check back later for amazing rewards you can redeem with your points!
        }
      </p>
      @if (searchTerm) {
        <button class="reset-btn" style="margin-top: 20px;" (click)="resetSearch()">Clear Search</button>
      }
    </div>
  }

  @if (!isLoading && rewards.length > 0) {
    <div class="reward-grid">
      @for (r of rewards; track r.id) {
        <div class="reward-card" [class.out-of-stock]="r.stockQuantity === 0" [class.can-redeem]="canRedeem(r)">
          <!-- Stock Badge -->
          @if (r.stockQuantity === 0) {
            <div class="stock-badge out-of-stock">Out of Stock</div>
          } @else if (r.stockQuantity <= 5) {
            <div class="stock-badge low-stock">Only {{ r.stockQuantity }} left!</div>
          }

          <!-- Image -->
          <div class="reward-image-wrapper">
            <img [src]="r.imageUrl" [alt]="r.name">
          </div>

          <!-- Content -->
          <div class="reward-card-content">
            <h3 class="reward-title">{{ r.name }}</h3>
            <p class="reward-description">{{ r.description }}</p>

            <!-- Points -->
            <div class="reward-points">
              <span class="points-icon">â­</span>
              <span class="points-value">{{ r.requiredPoints }}</span>
              <span class="points-text">Points</span>
            </div>

            <!-- Stock Info -->
            <div class="stock-info">
              <span class="stock-icon">ğŸ“¦</span>
              <span [class.text-danger]="r.stockQuantity === 0"
                    [class.text-warning]="r.stockQuantity > 0 && r.stockQuantity <= 5"
                    [class.text-success]="r.stockQuantity > 5">
                {{ r.stockQuantity }} available
              </span>
            </div>

            <!-- Add to Cart Button -->
            <button
              class="add-to-cart-btn"
              [class.disabled]="!canRedeem(r) || isInCart(r)"
              [class.in-cart]="isInCart(r)"
              [disabled]="!canRedeem(r) && !isInCart(r)"
              (click)="isInCart(r) ? removeFromCart(r) : addToCart(r)">
              @if (isInCart(r)) {
                <span>âœ… In Cart - Remove</span>
              } @else if (r.stockQuantity === 0) {
                <span>âŒ Out of Stock</span>
              } @else if (userPoints() < r.requiredPoints) {
                <span>ğŸ”’ Need {{ r.requiredPoints - userPoints() }} more</span>
              } @else {
                <span>ğŸ›’ Add to Cart</span>
              }
            </button>
          </div>
        </div>
      }
    </div>
  }
  </div>
</div>

<!-- Cart Modal Popup -->
@if (showCartModal()) {
  <div class="modal-backdrop" (click)="closeCart()"></div>
  <div class="cart-modal">
    <div class="cart-modal-header">
      <h2>ğŸ›’ My Cart</h2>
      <button class="close-modal-btn" (click)="closeCart()">Ã—</button>
    </div>

    <div class="cart-modal-content">
      @if (cart().length === 0) {
        <div class="cart-empty">
          <span class="cart-empty-icon">ğŸ›’</span>
          <h3>Your cart is empty</h3>
          <p>Add some rewards to get started!</p>
        </div>
      } @else {
        <div class="cart-items">
          @for (item of cart(); track item.id) {
            <div class="cart-item">
              <div class="cart-item-image">
                <img [src]="item.imageUrl" [alt]="item.name">
              </div>
              <div class="cart-item-info">
                <h4>{{ item.name }}</h4>
                <p class="cart-item-points">â­ {{ item.requiredPoints }} points</p>
              </div>
              <button class="remove-item-btn" (click)="removeFromCart(item)">
                ğŸ—‘ï¸
              </button>
            </div>
          }
        </div>
      }
    </div>

    <div class="cart-modal-footer">
      <div class="cart-summary">
        <div class="summary-row">
          <span>Items in Cart:</span>
          <span class="summary-value">{{ cartItemCount() }}</span>
        </div>
        <div class="summary-row total">
          <span>Total Points:</span>
          <span class="summary-value text-primary">â­ {{ cartTotal() }}</span>
        </div>
        <div class="summary-row balance">
          <span>Your Balance:</span>
          <span class="summary-value" [class.text-danger]="cartTotal() > userPoints()" [class.text-success]="cartTotal() <= userPoints()">
            ğŸ’° {{ userPoints() }}
          </span>
        </div>
        @if (cartTotal() > userPoints()) {
          <div class="summary-warning">
            âš ï¸ You need {{ cartTotal() - userPoints() }} more points!
          </div>
        }
      </div>

      <div class="cart-actions">
        <button
          class="clear-cart-btn"
          (click)="clearCart()"
          [disabled]="cart().length === 0">
          Clear Cart
        </button>
        <button
          class="redeem-cart-btn"
          (click)="redeemCart()"
          [disabled]="cart().length === 0 || cartTotal() > userPoints() || isCheckingOut()"
          [class.disabled]="cart().length === 0 || cartTotal() > userPoints()">
          @if (isCheckingOut()) {
            <span>â³ Processing...</span>
          } @else {
            <span>âœ¨ Redeem All ({{ cartTotal() }} pts)</span>
          }
        </button>
      </div>
    </div>
  </div>
}

